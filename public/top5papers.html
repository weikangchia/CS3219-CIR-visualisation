<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="./css/bootstrap.min.css">

  <link rel="stylesheet" href="css/custom.css">

  <script src="./js/d3.v4.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <a class="navbar-brand" href="#">Pair 2</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="./top10authors.html">Top 10 Authors</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="./top5papers.html">Top 5 Papers</a>
          <span class="sr-only">(current)</span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="./publicationtrend.html">Publication Trend</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="./web.html">Citation Web</a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <h1>Top 5 Papers for Venue arXiv</h1>

    <div class="row">
      <div class="col">
        <div id="graphHorizontal"></div>
        <div class="toolTip"></div>
      </div>
      <div class="col">
        <div id="graphBubble"></div>
      </div>
    </div>
  </div>

  <!-- d3 Script -->

  <script>
    const data = [{
      "name": "Bob",
      "count": 33
    }, {
      "name": "Robin",
      "count": 12
    }, {
      "name": "Anne",
      "count": 41
    }, {
      "name": "Mark",
      "count": 16
    }, {
      "name": "Joe",
      "count": 59
    }, {
      "name": "Eve",
      "count": 38
    }];

    // format the data
    data.forEach(function (d) {
      d.count = +d.count;
    });

    const countMin = d3.min(data, function (d) {
      return d.count;
    });

    const countMax = d3.max(data, function (d) {
      return d.count;
    });

    // code for bar chart

    // set the dimensions and margins of the graph
    const barMargin = {
      top: 20,
      right: 70,
      bottom: 70,
      left: 70
    };

    const barWidth = 450 - barMargin.left - barMargin.right;
    const barHeight = 500 - barMargin.top - barMargin.bottom;
    const barPadding = 100; // space around the chart, not including labels

    // set the ranges
    const x = d3.scaleBand()
      .range([0, barWidth])
      .padding(0.1);
    const y = d3.scaleLinear()
      .range([barHeight, 0]);

    const toolTip = d3.select(".toolTip");

    // append the svg object to the body of the page
    // append a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    const barSvg = d3.select("#graphHorizontal").append("svg")
      .attr("width", barWidth + barMargin.left + barMargin.right)
      .attr("height", barHeight + barMargin.top + barMargin.bottom)
      .append("g")
      .attr("transform", "translate(" + barMargin.left + "," + barMargin.top + ")");

    // scale the range of the data in the domains
    y.domain([0, countMax]);
    x.domain(data.map(function (d) {
      return d.name;
    }));

    // append the rectangles for the bar chart
    barSvg.selectAll(".bar")
      .data(data)
      .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function (d) {
        return x(d.name);
      })
      .attr("width", x.bandwidth())
      .attr("y", barHeight)
      .attr("height", 0)
      .on("mousemove", function (d) {
        toolTip.style("left", (d3.event.pageX - 100) + "px");
        toolTip.style("top", (d3.event.pageY - 200) + "px");
        toolTip.style("display", "inline-block");
        toolTip.html((d.name) + "<br>" + (d.count) + " citations");
      })
      .on("mouseout", function (d) {
        toolTip.style("display", "none");
      })
      .transition().duration(1000)
      .attr("y", function (d) {
        return y(d.count);
      })
      .attr("height", calcBarHeight);

    function calcBarHeight(d) {
      return barHeight - y(d.count);
    }

    // add the x-axis
    barSvg.append("g")
      .attr("class", "axis")
      .attr("transform", "translate(0," + barHeight + ")")
      .call(d3.axisBottom(x));

    // add the y-axis
    barSvg.append("g")
      .attr("class", "axis")
      .call(d3.axisLeft(y));

    // add y-axis title
    barSvg.append("text")
      .attr("text-anchor", "middle")
      .attr("transform", "translate(" + (-barPadding / 2) + "," + (barHeight / 2) + ")rotate(-90)")
      .text("Number of Citations");

    // add x-axis title
    barSvg.append("text")
      .attr("text-anchor", "middle")
      .attr("transform", "translate(" + (barWidth / 2) + "," + (barHeight - (-barPadding / 2)) + ")")
      .text("Paper");

    // code for bubble chart

    const colors = d3.schemeCategory20c;
    const bubbleWidth = 450;
    const bubbleHeight = 450;

    const bubbleSvg = d3.select("#graphBubble")
      .append("svg")
      .attr("height", bubbleHeight)
      .attr("width", bubbleWidth)
      .append("g").attr("transform", "translate(" + bubbleWidth / 2 + "," + bubbleHeight / 2 + ")");

    const radiusScale = d3.scaleSqrt()
      .domain([countMin, countMax]).range([35, 70]);

    // the simulation is a collection of forces about where
    // we want the circles to go and how we want the circles to interact
    const simulation = d3.forceSimulation()
      .force("x", d3.forceX(0).strength(0.05))
      .force("y", d3.forceY(0).strength(0.05))
      .force("collide", d3.forceCollide(function (d) {
        return radiusScale(d.count);
      }));

    const circles = bubbleSvg.selectAll(".paper")
      .data(data)
      .enter().append("circle")
      .attr("class", "paper")
      .attr("r", function (d) {
        return radiusScale(d.count);
      })
      .attr("fill", function (d, i) {
        return colors[i];
      })
      .call(d3.drag()
        .on("start", dragStarted)
        .on("drag", dragged)
        .on("end", dragEnded));;

    const labels = bubbleSvg.selectAll(".label")
      .data(data)
      .enter()
      .append("text")
      .attr("class", "label")
      .append("tspan")
      .text(function (d) {
        return d.name;
      });

    simulation.nodes(data)
      .on("tick", ticked);

    function ticked() {
      circles
        .attr("cx", function (d) {
          return d.x;
        })
        .attr("cy", function (d) {
          return d.y;
        });

      labels.attr("x", function (d) {
          return d.x;
        })
        .attr("y", function (d) {
          return d.y;
        })
    }

    function dragStarted(d) {
      if (!d3.event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

    function dragged(d) {
      d.fx = d3.event.x;
      d.fy = d3.event.y;
    }

    function dragEnded(d) {
      if (!d3.event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }
  </script>


  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="./js/jquery-3.2.1.slim.min.js"></script>
  <script src="./js/popper.min.js"></script>
  <script src="./js/bootstrap.min.js"></script>
</body>

</html>
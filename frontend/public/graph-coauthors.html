<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="shortcut icon" href="./image/favicon.ico">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="./css/bootstrap.min.css">

  <link rel="stylesheet" href="css/custom.css">

  <link rel="stylesheet" href="css/fakeLoader.css">

  <link rel="stylesheet" href="./css/font-awesome.min.css">

  <link rel="stylesheet" href="./css/nouislider.min.css">

  <script src="./js/d3.min.js"></script>
  <script src="./js/d3plus.full.min.js"></script>
  <script src="./js/jquery.min.js"></script>
  <script src="./js/angular.min.js"></script>
  <script src="./js/fakeLoader.min.js"></script>
  <script src="./js/nouislider.min.js"></script>
  <script src="./js/wNumb.js"></script>
  <script src="./js/utils.js"></script>
</head>

<body ng-app="">
  <div id="fakeLoader"></div>
  <div ng-include="'nav.html'"></div>

  <div class="container">
    <div class="row">
      <div class="col">
        <h1>Citation Web</h1>
        <p>A citation web for a base author. Up to 2 levels of co-authors is created (i.e. if the base author is A, capture
          up to C: B published the paper with A, and C published the paper with B, so A
          <- B <- C) </p>
      </div>
    </div>

    <div class="row">
      <div class="col col-12 col-md-8 order-2 order-md-1">
        <div id="graph"></div>
      </div>
      <div class="col col-12 col-md-4 order-1 order-md-2">
        <h5>Filtering</h5>

        <form id="filterForm">
          <div class="form-group">
            <label for="name">Base Author</label>
            <input class="form-control" id="name" placeholder="Author Name">
          </div>

          <h6>Level &#40;<span id="current-level">2</span>&#41;</h6>
          <div class="form-group row">
            <div class="col-12">
              <div id="slider"></div>
            </div>
          </div>

          <div class="form-group row">
            <div class="col-sm-10">
              <button type="submit" class="btn btn-sm btn-primary">Submit</button>
            </div>
          </div>

        </form>
      </div>
    </div>

    <!-- filter script -->
    <script>
      // init fakeloader
      initFakeLoader();

      // scripts for year slider
      const slider = document.getElementById('slider');

      noUiSlider.create(slider, {
        start: 2,
        padding: 0,
        range: {
          'min': 1,
          'max': 3
        },
        step: 1,
        format: wNumb({
          decimals: 0
        })
      });

      slider.noUiSlider.on('change', function () {
        const levelSliderValue = slider.noUiSlider.get();
        $("#current-level").text(levelSliderValue[0]);
      });

      // scripts for the input
      $("#filterForm").submit(() => {
        showFakeLoader();

        const currentLevel = slider.noUiSlider.get()[0];
        const name = $("#name").val();

        axios.get(
          `${API_HOST}/graph/co-Authors?levels=${currentLevel}&author=${name}`
        ).then(
          response => {
            updateVisualization(response.data);
            hideFakeLoader();
          });
      });

    </script>

  <!-- d3 Script -->
<<<<<<< HEAD:frontend/public/graph-coAuthors.html
   <script>
      function updateVisualization(data) {
        $("#graph").empty();
        var visualization = d3plus.viz()
          .container("#graph")
          .type("network")
          .data(data.nodes)
          .edges(data.links)
          .edges({
            "arrows": 4,
            "strength": 1.4
=======

  <script>
    $("#fakeLoader").fakeLoader({
      zIndex: "999",
      spinner: "spinner1",
      bgColor: "#2ecc71"
    });

    const tip = d3.tip().attr('class', 'd3-tip').html(function (d) {
      return d.htmlText;
    });

    d3.json(API_HOST + "/graph/coauthors?" + searchParams.toString(), function (error, data) {
      if (error) return showError('Server Error')
      $("#fakeLoader").hide();

      const width = 1500;
      const height = 1500;

      const svg = d3.select('#graph')
        .append('svg')
        .attr('width', width)
        .attr('height', height)
        .call(tip);

      const simulation = d3.forceSimulation()
        .force("link", d3.forceLink().id(function (d) {
          return d.id;
        }))
        .force("charge", d3.forceManyBody().strength(-200))
        .force("center", d3.forceCenter(width / 2, height / 2));

      const link = svg.append("g")
        .attr("class", "links")
        .selectAll("line")
        .data(data.links)
        .enter().append("line");

      const node = svg.append("g")
        .attr("class", "nodes")
        .selectAll("circle")
        .data(data.nodes)
        .enter().append("circle")
        .attr("r", 8)
        .attr("fill", function (d) {
          return d3.schemeCategory20c[d.level * 2];
        })
        .on("mouseover", function (d) {
          let htmlText = `<h5>${d.title}</h5>(Level: ${d.level}) ${d.author}`;

          // if (d.level > 1) {
          //   const sources = _.filter(data.links, (link) => link.target.id == d.id)
          //     .map((match) => {
          //       return "(Level " + match.source.level + ")\t" + match.source.title;
          //     });
          // //   htmlText = htmlText.concat(`<br><br><h6>In citations (${sources.length})</h6>${sources.join("<br>")}`);
          // }

          d.htmlText = htmlText;
          tip.show(d);
        })
        .on("mouseout", function (d) {
          tip.hide();
        })
        .call(d3.drag()
          .on("start", dragStarted)
          .on("drag", dragged)
          .on("end", dragEnded));

      simulation
        .nodes(data.nodes)
        .on("tick", ticked);

      simulation.force("link")
        .links(data.links);

      svg.append("svg:defs").selectAll("marker")
        .data(["end"])
        .enter().append("svg:marker")
        .attr("id", String)
        .attr("viewBox", "0 -5 10 10")
        .attr("refX", 25)
        .attr("refY", 0)
        .attr("markerWidth", 5)
        .attr("markerHeight", 5)
        .attr("orient", "auto")
        .append("svg:path")
        .attr("d", "M0,-5L10,0L0,5");

      function ticked() {
        link
          .attr("x1", function (d) {
            return d.source.x;
>>>>>>> a811a08fa00f392c5ec2e0cdcb51996a0be6f078:frontend/public/graph-coauthors.html
          })
          .size({
            value: 5
          })
          .id("id")
          .width({
            value: $("#graph").width()
          })
          .height({
            value: 500
          })
          .labels({
            value: false
          })
          .tooltip({
            stacked: true,
            large: 500,
            fullscreen: true,
            html: function (id) {
              console.log(data.nodes);
              const paper = data.nodes.find(node => node.id === id);
              const viewUrl = googleScholarSearchUrl(paper.title);

              const htmlText =
                `<h6>${paper.title} (${paper.year})</h6>` +
                `<b>Author:</b> ${paper.authors.find(author => author.ids[0] === id).name}<br/>`;
                // +
                // `<b>Abstract:</b> ${paper.abstract}<br/><br/><a class="btn btn-secondary btn-sm" href="${viewUrl}" role="button" target="_blank">View</a>`;

              return htmlText;
            }
          })
          .draw();
      }

    </script>

    <!-- Optional JavaScript -->
    <script src="./js/axios.min.js"></script>
    <script src="./js/popper.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>

</body>

</html>
